> åŸæ–‡åœ°å€ [segmentfault.com](https://segmentfault.com/a/1190000044903044)

> **ç¼–è€…æŒ‰ï¼š** å¤§è¯­è¨€æ¨¡å‹æ‹¥æœ‰ä»¤äººæƒŠå¹çš„è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œå´ä¹Ÿå­˜åœ¨è‡ªä¸»å†³ç­–ã€ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ç­‰æ–¹é¢çš„ä¸è¶³ã€‚å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰æŠ€æœ¯çš„å‡ºç°ï¼Œæ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€éš¾é¢˜è€Œç”Ÿçš„åˆ›æ–°æ–¹æ¡ˆï¼Œå®ƒèµ‹äºˆäº†å¤§è¯­è¨€æ¨¡å‹æ›´å¼ºçš„è‡ªä¸»èƒ½åŠ›å’Œä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥çš„èƒ½åŠ›ï¼Œæˆä¸ºå®ç°çœŸæ­£æ™ºèƒ½è‡ªä¸»Â AgentÂ çš„å…³é”®ä¸€ç¯ã€‚
> 
> æœ¬æœŸæˆ‘ä»¬ç²¾å¿ƒä¸ºå„ä½è¯»è€…ä¼™ä¼´å‘ˆç°ä¸€ç¯‡è¯¦å®çš„æ­å»ºæŠ€æœ¯æ•™ç¨‹ï¼Œå…¨é¢ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨å‡½æ•°è°ƒç”¨æŠ€æœ¯æ„å»ºÂ Autonomous AI AgentsÂ ã€‚ä½œè€…ä»å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰çš„å·¥ä½œåŸç†å’Œåº”ç”¨åœºæ™¯å‡ºå‘ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªæ—…æ¸¸æœåŠ¡åŠ©æ‰‹çš„å®ä¾‹ï¼Œå±‚å±‚é€’è¿›åœ°è®²è§£äº†æ•´ä¸ªç³»ç»Ÿçš„è®¾è®¡æ€è·¯ã€æŠ€æœ¯ç»†èŠ‚å’Œä»£ç å®ç°ã€‚
> 
> å¸Œæœ›é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œå„ä½è¯»è€…ä¼™ä¼´èƒ½è·å¾—å¯å‘ï¼Œä¸ºå¼€å‘æ›´æ™ºèƒ½ã€æ›´äººæ€§åŒ–çš„Â AI AgentsÂ å¯»å¾—æ›´å®½å¹¿çš„å…‰æ˜å¤§é“ã€‚

**ä½œè€… | Julian Yip**

**ç¼–è¯‘Â |Â å²³æ‰¬**

å‡½æ•°è°ƒç”¨å¹¶éä¸€ä¸ªæ–°é²œæ¦‚å¿µã€‚æ—©åœ¨Â 2023Â å¹´Â 7Â æœˆï¼ŒÂ  OpenAIÂ å°±ä¸ºå…¶Â GPTÂ æ¨¡å‹å¼•å…¥äº†è¿™ä¸€åŠŸèƒ½ï¼Œç°åœ¨è¿™ä¸€åŠŸèƒ½ä¹Ÿè¢«å…¶ä»–ç«äº‰å¯¹æ‰‹é‡‡ç”¨ã€‚æ¯”å¦‚ï¼Œè°·æ­Œçš„Â Gemini APIÂ æœ€è¿‘ä¹Ÿå¼€å§‹æ”¯æŒå‡½æ•°è°ƒç”¨ï¼ŒÂ AnthropicÂ ä¹Ÿåœ¨å°†å…¶æ•´åˆåˆ°Â ClaudeÂ ä¸­ã€‚å‡½æ•°è°ƒç”¨ï¼ˆè¯‘è€…æ³¨ï¼šFunction Callingï¼Œå…è®¸æ¨¡å‹é€šè¿‡è°ƒç”¨ç‰¹å®šçš„å‡½æ•°æ¥æ‰§è¡ŒæŸäº›å¤æ‚ä»»åŠ¡ã€‚ï¼‰å·²ç»æˆä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰çš„å…³é”®åŠŸèƒ½ä¹‹ä¸€ï¼Œèƒ½å¤Ÿæ˜¾è‘—å¢å¼ºå¤§æ¨¡å‹åº”ç”¨èƒ½åŠ›ã€‚å› æ­¤ï¼Œå­¦ä¹ è¿™é¡¹æŠ€æœ¯æ˜¯æå…¶æœ‰æ„ä¹‰çš„ã€‚

åŸºäºæ­¤ï¼Œæˆ‘æ‰“ç®—æ’°å†™ä¸€ç¯‡è¯¦ç»†çš„æ•™ç¨‹ï¼Œå†…å®¹é‡ç‚¹ä¸ºåŸºç¡€ä»‹ç»ï¼ˆå› ä¸ºè¿™ç±»æ•™ç¨‹å·²ç»å¾ˆå¤šäº†ï¼‰ä¹‹å¤–çš„å†…å®¹ã€‚æœ¬æ•™ç¨‹å°†ä¸“æ³¨äºå®é™…åº”ç”¨ä¸Šï¼Œå±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªÂ fully autonomous AI agentï¼ˆè¯‘è€…æ³¨ï¼šèƒ½å¤Ÿç‹¬ç«‹è¿è¡Œå’Œåšå‡ºå†³ç­–çš„ã€ä¸éœ€è¦äººä¸ºå¹²é¢„çš„Â AI agentÂ ã€‚ï¼‰ï¼Œå¹¶å°†å…¶ä¸Â StreamlitÂ é›†æˆæ¥å®ç°ç±»ä¼¼Â ChatGPTÂ çš„Â WebÂ äº¤äº’ç•Œé¢ã€‚**è™½ç„¶æœ¬æ•™ç¨‹ä½¿ç”¨Â OpenAIÂ è¿›è¡Œæ¼”ç¤ºï¼Œä½†æœ¬æ–‡å†…å®¹åŒæ ·é€‚ç”¨äºå…¶ä»–æ”¯æŒå‡½æ•°è°ƒç”¨çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œä¾‹å¦‚Â Geminiã€‚**

**01 å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰çš„ç”¨é€”æœ‰å“ªäº›ï¼Ÿ**
------------------------------------

Function CallingÂ è¿™ä¸€æŠ€æœ¯è®©å¼€å‘è€…èƒ½å¤Ÿå®šä¹‰å‡½æ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºå·¥å…·ï¼ˆtoolsï¼‰ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºæ¨¡å‹è¦æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚è¿›è¡Œæ•°å­¦è¿ç®—æˆ–ä¸‹è®¢å•ï¼‰ï¼Œå¹¶è®©æ¨¡å‹æ™ºèƒ½åœ°é€‰æ‹©å¹¶è¾“å‡ºä¸€ä¸ªåŒ…å«è°ƒç”¨è¿™äº›å‡½æ•°æ‰€éœ€å‚æ•°çš„Â JSONÂ å¯¹è±¡ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸€æŠ€æœ¯å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š

*   **è‡ªä¸»å†³ç­–ï¼ˆAutonomous decision makingï¼‰** ï¼šæ¨¡å‹èƒ½å¤Ÿæ™ºèƒ½åœ°é€‰æ‹©æ‰€éœ€å·¥å…·æ¥å›ç­”é—®é¢˜ã€‚
*   **å¯é åœ°è§£æè¿‡ç¨‹ï¼ˆReliable parsingï¼‰** ï¼šå“åº”ä¸€èˆ¬ä»¥Â JSONÂ æ ¼å¼å‘ˆç°ï¼Œè€Œéæ›´å…¸å‹çš„å¯¹è¯å¼å“åº”ï¼ˆdialogue-like responseï¼‰ã€‚ä¹çœ‹ä¹‹ä¸‹ä¼¼ä¹æ²¡ä»€ä¹ˆï¼Œä½†æ­£æ˜¯è¿™ç§æŠ€æœ¯ä½¿å¾—Â LLMÂ èƒ½å¤Ÿé€šè¿‡ç»“æ„åŒ–è¾“å…¥ï¼ˆÂ structured inputsï¼‰è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚é€šè¿‡Â APIÂ è¿›è¡Œäº¤äº’ã€‚

è¿™ç§æŠ€æœ¯ä¸ºäººä»¬å¸¦æ¥äº†å„ç§å„æ ·çš„æ–°æœºé‡ã€æ–°æœºä¼šï¼š

*   **Autonomous AI assistants**ï¼šæœºå™¨äººä¸ä»…å¯ä»¥å›ç­”ç”¨æˆ·å’¨è¯¢çš„é—®é¢˜ï¼Œè¿˜èƒ½ä¸å†…éƒ¨ç³»ç»Ÿï¼ˆè¯‘è€…æ³¨ï¼šä¼ä¸šå†…éƒ¨ç”¨äºå¤„ç†å†…éƒ¨ä¸šåŠ¡æµç¨‹ã€æ•°æ®ç®¡ç†ã€å®¢æˆ·å…³ç³»ç­‰ä»»åŠ¡çš„ç³»ç»Ÿï¼‰äº¤äº’ï¼Œå¤„ç†å®¢æˆ·ä¸‹è®¢å•å’Œé€€è´§ç­‰ä»»åŠ¡ã€‚
*   **Personal research assistants**ï¼šæ¯”æ–¹è¯´ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ¶å®šæ—…è¡Œè®¡åˆ’æ—¶ï¼Œå¯ä»¥è¯·è¿™äº›åŠ©ç†åœ¨äº’è”ç½‘æœç´¢å†…å®¹ã€çˆ¬å–å†…å®¹ã€æ¯”è¾ƒå†…å®¹ï¼Œå¹¶å°†ç»“æœæ±‡æ€»åˆ°Â ExcelÂ ä¸­ã€‚
*   **IoT voice commands**ï¼šæ¨¡å‹å¯ä»¥æ ¹æ®æ£€æµ‹åˆ°çš„ç”¨æˆ·æ„å›¾æ¥æ§åˆ¶è®¾å¤‡æˆ–ç»™å‡ºæ“ä½œå»ºè®®ï¼Œä¾‹å¦‚è°ƒèŠ‚ç©ºè°ƒæ¸©åº¦ã€‚

**02 å‡½æ•°è°ƒç”¨åŠŸèƒ½çš„è¿è¡Œæµç¨‹**
------------------

å‚è€ƒÂ GeminiÂ çš„å‡½æ•°è°ƒç”¨æ–‡æ¡£ï¼Œå‡½æ•°è°ƒç”¨åŠŸèƒ½çš„è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼ŒOpenAIÂ ä¸­æ­¤åŠŸèƒ½çš„å·¥ä½œåŸç†åŸºæœ¬ç›¸åŒï¼š

![å‡½æ•°è°ƒç”¨åŠŸèƒ½çš„è¿è¡Œæµç¨‹](../_img/function_calling_flow.png)



**1. ç”¨æˆ·å‘åº”ç”¨ç¨‹åºå‘å‡ºæç¤ºè¯ï¼ˆpromptï¼‰**

**2. åº”ç”¨ç¨‹åºä¼šä¼ é€’ç”¨æˆ·æä¾›çš„æç¤ºè¯å’Œå‡½æ•°å£°æ˜ï¼ˆFunction Declaration(s)ï¼‰ï¼Œå³å¯¹æ¨¡å‹æ‰€éœ€å·¥å…·çš„æè¿°ä¿¡æ¯**

**3. æ ¹æ®å‡½æ•°å£°æ˜ï¼Œæ¨¡å‹ä¼šç»™å‡ºå·¥å…·é€‰å–å»ºè®®å’Œç›¸å…³çš„è¯·æ±‚å‚æ•°ã€‚æ³¨æ„ï¼Œæ¨¡å‹ä»…ä¼šè¾“å‡ºå»ºè®®çš„å·¥å…·å’Œè¯·æ±‚å‚æ•°ï¼Œå¹¶ä¸ä¼šå®é™…è°ƒç”¨å‡½æ•°**

**4.Â & 5. åº”ç”¨ç¨‹åºæ ¹æ®æ¨¡å‹å“åº”è°ƒç”¨ç›¸å…³Â API**

**6.Â & 7. å°†Â APIÂ çš„å“åº”å†…å®¹å†æ¬¡è¾“å…¥æ¨¡å‹ï¼Œç”Ÿæˆäººç±»å¯è¯»çš„å†…å®¹**

**8.Â åº”ç”¨ç¨‹åºå°†æœ€ç»ˆå“åº”è¿”å›ç»™ç”¨æˆ·ï¼Œç„¶åå†æ¬¡å›åˆ°ç¬¬Â 1Â æ­¥ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤**

ä¸Šè¿°çš„ä»‹ç»å†…å®¹å¯èƒ½çœ‹èµ·æ¥æœ‰äº›è®¸å¤æ‚ï¼Œæ¥ä¸‹æ¥å°†é€šè¿‡å®ä¾‹è¯¦ç»†è§£é‡Šè¯¥æ¦‚å¿µã€‚

**03 è¯¥Â AgentsÂ çš„æ•´ä½“è®¾è®¡å’Œæ€»ä½“æ¶æ„**
--------------------------

åœ¨æ·±å…¥è®²è§£å…·ä½“ä»£ç ä¹‹å‰ï¼Œå…ˆç®€è¦ä»‹ç»ä¸€ä¸‹æœ¬æ–‡ä»‹ç»çš„è¿™ä¸ªÂ AgentsÂ çš„æ•´ä½“è®¾è®¡å’Œæ€»ä½“æ¶æ„ã€‚

### **3.1 Solutionï¼šæ—…æ¸¸æœåŠ¡åŠ©æ‰‹**

åœ¨æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†ä¸ºå¤–å‡ºæ—…æ¸¸çš„é…’åº—é¡¾å®¢æ„å»ºä¸€ä¸ªæ—…æ¸¸æœåŠ¡åŠ©æ‰‹ï¼Œè¯¥äº§å“å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼ˆè¿™äº›å·¥å…·ä½¿å¾—è¯¥æœåŠ¡åŠ©æ‰‹èƒ½å¤Ÿè®¿é—®å¤–éƒ¨åº”ç”¨ç¨‹åºï¼‰ã€‚

*   **get_itemsÂ å’ŒÂ purchase_item**ï¼šé€šè¿‡Â APIÂ è¿æ¥åˆ°æ•°æ®åº“ä¸­çš„äº§å“ç›®å½•ï¼ˆproduct catalogï¼‰ï¼Œè¿™ä¸¤ä¸ªå·¥å…·åˆ†åˆ«ç”¨äºè·å–å•†å“åˆ—è¡¨å’Œè¿›è¡Œå•†å“è´­ä¹°
*   **rag_pipeline_func**ï¼šé€šè¿‡æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰è¿æ¥åˆ°å­˜å‚¨å’Œç®¡ç†æ–‡æ¡£æ•°æ®çš„å­˜å‚¨ç³»ç»Ÿï¼Œä»¥ä¾¿ä»éç»“æ„åŒ–æ–‡æœ¬ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚é…’åº—çš„å®£ä¼ å†Œ

![Alt text](../_img/get_items_purchase_item.png)

### **3.2 ç›¸å…³æŠ€æœ¯æ ˆ**

*   **åµŒå…¥æ¨¡å‹ï¼ˆEmbedding modelï¼‰** ï¼šall-MiniLM-L6-v2[2]
*   **å‘é‡æ•°æ®åº“ï¼ˆVector Databaseï¼‰** ï¼šHaystackÂ çš„Â InMemoryDocumentStore[3]
*   **å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰** ï¼šé€šè¿‡Â OpenRouterÂ è®¿é—®Â GPT-4 Turbo[4]ã€‚åªè¦æ”¯æŒå‡½æ•°è°ƒç”¨ï¼Œç¨ä½œä»£ç ä¿®æ”¹å³å¯ä½¿ç”¨å…¶ä»–å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚Â Geminiï¼‰ã€‚
*   **LLMÂ æ¡†æ¶**ï¼šä½¿ç”¨Â Haystack[5]ï¼Œå› ä¸ºå®ƒæ˜“äºä½¿ç”¨ï¼Œæ–‡æ¡£è¯¦å°½ï¼Œå¹¶ä¸”åœ¨Â pipelineÂ çš„æ„å»ºæ–¹é¢æ¯”è¾ƒé€æ˜ã€‚æœ¬æ•™ç¨‹å®é™…ä¸Šæ˜¯å¯¹è¯¥æ¡†æ¶ä½¿ç”¨æ•™ç¨‹[6]çš„æ‰©å±•ã€‚

ç°åœ¨å¼€å§‹ä»‹ç»å§ï¼

**04 ä½¿ç”¨ä¸Šè¿°æŠ€æœ¯æ ˆæ„å»ºä¸€ä¸ªÂ AgentÂ æ ·ä¾‹**
---------------------------

### **4.1 å‰æœŸå‡†å¤‡å·¥ä½œ**

å‰å¾€Â Github[7]Â å…‹éš†æœ¬é¡¹ç›®ä»£ç ã€‚ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨Â NotebookÂ `function_calling_demo`Â ä¸­æ‰¾åˆ°ã€‚

è¯·åˆ›å»ºå¹¶æ¿€æ´»ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œç„¶åè¿è¡ŒÂ pip installÂ -r requirements.txtÂ å®‰è£…æ‰€éœ€çš„åŒ…ã€‚

### **4.2 é¡¹ç›®åˆå§‹åŒ–**

é¦–å…ˆè¿æ¥Â OpenRouterã€‚å¦‚æœæœ‰Â OpenAI APIÂ å¯†é’¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸå§‹çš„Â `OpenAIChatGenerator`Â è€Œä¸é‡å†™è¦†ç›–Â `api_base_url`Â å‚æ•°ã€‚

```python
importÂ os
fromÂ dotenvÂ importÂ load_dotenv
fromÂ haystack.components.generators.chatÂ importÂ OpenAIChatGenerator
fromÂ haystack.utilsÂ importÂ Secret
fromÂ haystack.dataclassesÂ importÂ ChatMessage
fromÂ haystack.components.generators.utilsÂ importÂ print_streaming_chunk

#Â Set your API key as environment variable before executing this
load_dotenv()
OPENROUTER_API_KEYÂ =Â os.environ.get('OPENROUTER_API_KEY')

chat_generatorÂ =Â OpenAIChatGenerator(api_key=Secret.from_env_var("OPENROUTER_API_KEY"),
Â Â api_base_url="https://openrouter.ai/api/v1",
Â Â model="openai/gpt-4-turbo-preview",
Â Â Â Â Â Â Â Â streaming_callback=print_streaming_chunk)  
```

**æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•Â chat_generatorÂ æ˜¯å¦èƒ½æˆåŠŸè°ƒç”¨ã€‚**

```python
chat_generator.run(messages=[ChatMessage.from_user("Return this text:Â 'test'")])
```

```python
----------Â The response should look like thisÂ ----------
{'replies': [ChatMessage(content="'test'",Â role=<ChatRole.ASSISTANT: 'assistant'>,Â name=None,Â meta={'model': 'openai/gpt-4-turbo-preview', 'index': 0, 'finish_reason': 'stop', 'usage': {}})]}  
```

### **4.3 æ­¥éª¤Â 1ï¼šé€‰æ‹©ä½¿ç”¨åˆé€‚çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆ**

åœ¨æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨åº”ç”¨ç¨‹åºå’Œä¸¤ä¸ªæ•°æ®æºï¼ˆdata sourcesï¼‰ä¹‹é—´å»ºç«‹è¿æ¥ï¼šç”¨äºéç»“æ„åŒ–æ–‡æœ¬çš„æ–‡æ¡£å­˜å‚¨ç³»ç»Ÿï¼ˆDocument storeï¼‰ï¼Œä»¥åŠé€šè¿‡Â APIÂ è¿æ¥çš„åº”ç”¨ç¨‹åºæ•°æ®åº“ï¼ˆapplication database via APIï¼‰ã€‚

**ä½¿ç”¨Â PipelineÂ ç»™æ–‡æ¡£ç¼–åˆ¶ç´¢å¼•**

éœ€è¦ç»™ç³»ç»Ÿæä¾›æ–‡æœ¬æ ·æœ¬ï¼ˆsample textsï¼‰ï¼Œä»¥ä¾›æ¨¡å‹è¿›è¡Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è½¬æ¢ä¸ºåµŒå…¥ï¼ˆembeddingsï¼‰ï¼Œå¹¶ä½¿ç”¨å°†æ–‡æ¡£æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆã€‚

```python
fromÂ haystackÂ importÂ Pipeline,Â Document
fromÂ haystack.document_stores.in_memoryÂ importÂ InMemoryDocumentStore
fromÂ haystack.components.writersÂ importÂ DocumentWriter
fromÂ haystack.components.embeddersÂ importÂ SentenceTransformersDocumentEmbedder

#Â Sample documents
documentsÂ = [
Â Â Â Â Document(content="Coffee shop opens at 9am and closes at 5pm."),
Â Â Â Â Document(content="Gym room opens at 6am and closes at 10pm.")
]

#Â Create the document store
document_storeÂ =Â InMemoryDocumentStore()

#Â Create a pipeline to turn the texts into embeddings and store them in the document store
indexing_pipelineÂ =Â Pipeline()
indexing_pipeline.add_component(
 "doc_embedder",Â SentenceTransformersDocumentEmbedder(model="sentence-transformers/all-MiniLM-L6-v2")
)
indexing_pipeline.add_component("doc_writer",Â DocumentWriter(document_store=document_store))

indexing_pipeline.connect("doc_embedder.documents", "doc_writer.documents")

indexing_pipeline.run({"doc_embedder": {"documents":Â documents}})
```

ä¸Šè¿°ç¨‹åºçš„è¾“å‡ºç»“æœåº”è¯¥ä¸è¾“å…¥çš„ç¤ºä¾‹æ–‡æ¡£æ•°æ®ä¿æŒä¸€è‡´ï¼š

```python
{'doc_writer':Â {'documents_written':Â 2}}
```

**å¯åŠ¨Â APIÂ æœåŠ¡è¿›ç¨‹**

åœ¨Â db_api.pyÂ æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªç”¨Â FlaskÂ æ¡†æ¶æ„å»ºçš„Â APIÂ æœåŠ¡ï¼Œç”¨äºè¿æ¥Â SQLiteÂ æ•°æ®åº“ã€‚è¯·åœ¨ç»ˆç«¯è¿è¡ŒÂ python db_api.pyï¼Œå¯åŠ¨è¯¥æœåŠ¡ã€‚

![Alt text](../_img/python_db_api.png)

å¦‚æœæœåŠ¡æˆåŠŸæ‰§è¡Œï¼Œç»ˆç«¯å°†æ˜¾ç¤ºå›¾ä¸­æ‰€ç¤ºçš„ä¿¡æ¯

æˆ‘æ³¨æ„åˆ°åœ¨Â db_api.pyÂ ä¸­é¢„ç½®ä¸€äº›åˆå§‹çš„åŸºç¡€æ•°æ®ã€‚

![Alt text](../_img/db_api_py.png)

_æ•°æ®åº“ä¸­çš„æ•°æ®æ ·æœ¬_

### 4.4 æ­¥éª¤Â 2ï¼šå®šä¹‰å‡½æ•°ï¼ˆDefine the functionsï¼‰

è¿™ä¸€æ­¥æ˜¯åœ¨å‡†å¤‡çœŸæ­£çš„å‡½æ•°ï¼Œä»¥ä¾›æ¨¡å‹åœ¨ä¹‹åçš„å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰æ­¥éª¤ä¸­è°ƒç”¨æ‰§è¡Œã€‚ï¼ˆå¦‚Â 02Â èŠ‚Â â€œå‡½æ•°è°ƒç”¨åŠŸèƒ½çš„è¿è¡Œæµç¨‹â€Â ä¸­æ‰€è¿°çš„æ­¥éª¤Â 4-5ï¼‰

**RAGÂ å‡½æ•°ï¼ˆRAG functionï¼‰**

å…¶ä¸­ä¹‹ä¸€å°±æ˜¯Â RAGÂ å‡½æ•°Â `rag_pipeline_func`ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è®©æ¨¡å‹èƒ½å¤Ÿæœç´¢ä¹‹å‰å­˜å‚¨åœ¨æ–‡æ¡£å­˜å‚¨ä¸­çš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶åŸºäºæœç´¢ç»“æœæä¾›ç­”æ¡ˆã€‚å®ƒé¦–å…ˆä½¿ç”¨Â HaystackÂ è¿™ä¸ªæ¡†æ¶ã€‚å°†Â RAGÂ ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„æ£€ç´¢è¿‡ç¨‹å®šä¹‰ä¸ºä¸€ä¸ªÂ pipelineÂ ã€‚

```python
fromÂ haystack.components.embeddersÂ importÂ SentenceTransformersTextEmbedder
fromÂ haystack.components.retrievers.in_memoryÂ importÂ InMemoryEmbeddingRetriever
fromÂ haystack.components.buildersÂ importÂ PromptBuilder
fromÂ haystack.components.generatorsÂ importÂ OpenAIGenerator

templateÂ = """
Answer the questions based on the given context.

Context:
{%Â for document in documentsÂ %}
Â Â Â Â {{Â document.contentÂ }}
{%Â endforÂ %}
Question:Â {{Â questionÂ }}
Answer:
"""
rag_pipeÂ =Â Pipeline()
rag_pipe.add_component("embedder",Â SentenceTransformersTextEmbedder(model="sentence-transformers/all-MiniLM-L6-v2"))
rag_pipe.add_component("retriever",Â InMemoryEmbeddingRetriever(document_store=document_store))
rag_pipe.add_component("prompt_builder",Â PromptBuilder(template=template))
#Â Note to llm:Â We are using OpenAIGenerator,Â not the OpenAIChatGenerator,Â because the latter only accepts List[str]Â as input and cannot accept prompt_builder's str output
rag_pipe.add_component("llm",Â OpenAIGenerator(api_key=Secret.from_env_var("OPENROUTER_API_KEY"),
Â Â api_base_url="https://openrouter.ai/api/v1",
Â Â model="openai/gpt-4-turbo-preview"))

rag_pipe.connect("embedder.embedding", "retriever.query_embedding")
rag_pipe.connect("retriever", "prompt_builder.documents")
rag_pipe.connect("prompt_builder", "llm")
```

æµ‹è¯•å‡½æ•°åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

```python
queryÂ =Â â€œWhen does the coffee shop open?â€
rag_pipe.run({"embedder":Â {"text":Â query},Â "prompt_builder":Â {"question":Â query}})
```

rag_pipeline_funcÂ å‡½æ•°åœ¨è¢«æ¨¡å‹è°ƒç”¨æ‰§è¡Œåï¼Œåº”è¯¥ä¼šäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºã€‚**è¯·æ³¨æ„ï¼Œæ¨¡å‹ç»™å‡ºçš„å›ç­”æ¥è‡ªäºæˆ‘ä»¬ä¹‹å‰æä¾›çš„æ ·æœ¬æ–‡æ¡£æ•°æ®ã€‚**

```python
{'llm': {'replies': ['The coffee shop opens at 9am.'],
 'meta': [{'model': 'openai/gpt-4-turbo-preview',
 'index': 0,
 'finish_reason': 'stop',
 'usage': {'completion_tokens': 9,
 'prompt_tokens': 60,
 'total_tokens': 69,
 'total_cost': 0.00087}}]}}
```

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†Â rag_pipeÂ è½¬åŒ–ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œåœ¨éœ€è¦æ—¶è°ƒç”¨Â rag_pipeline_func(query)Â è·å–åŸºäºÂ queryÂ çš„ç­”æ¡ˆï¼Œè€Œä¸ä¼šè¿”å›å…¶ä»–çš„ä¸­é—´ç»†èŠ‚ä¿¡æ¯ã€‚

```
def rag_pipeline_func(query: str):
Â Â Â Â resultÂ =Â rag_pipe.run({"embedder": {"text":Â query}, "prompt_builder": {"question":Â query}})

 return {"reply":Â result["llm"]["replies"][0]}
```

**å®šä¹‰ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„Â API**

åœ¨æ­¤å¤„ï¼Œæˆ‘ä»¬å®šä¹‰ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„Â `get_items`Â å‡½æ•°å’ŒÂ `purchase_itemfunctions`Â å‡½æ•°ã€‚

```python
 #Â Flask's default local URL,Â change it if necessary
db_base_urlÂ = 'http://127.0.0.1:5000'

#Â Use requests to get the data from the database
importÂ requests
importÂ json

#Â get_categories is supplied as part of the prompt,Â it is not used as a tool
def get_categories():
Â Â Â Â responseÂ =Â requests.get(f'{db_base_url}/category')
Â Â Â Â dataÂ =Â response.json()
 returnÂ data

def get_items(ids=None,categories=None):
Â Â Â Â paramsÂ = {
 'id':Â ids,
 'category':Â categories,
 }
Â Â Â Â responseÂ =Â requests.get(f'{db_base_url}/item',Â params=params)
Â Â Â Â dataÂ =Â response.json()
 returnÂ data

def purchase_item(id,quantity):

Â Â Â Â headersÂ = {
 'Content-type':'application/json', 
 'Accept':'application/json'
 }

Â Â Â Â dataÂ = {
 'id': id,
 'quantity':Â quantity,
 }
Â Â Â Â responseÂ =Â requests.post(f'{db_base_url}/item/purchase',Â json=data,Â headers=headers)
 returnÂ response.json()
```

**å®šä¹‰å·¥å…·å‡½æ•°åˆ—è¡¨**

ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸå®Œæˆå‡½æ•°çš„å®šä¹‰ï¼Œæ¥ä¸‹æ¥éœ€è¦è®©æ¨¡å‹è¯†åˆ«å¹¶äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä¸ºè¿™äº›å‡½æ•°æä¾›ä¸€äº›æè¿°è¯´æ˜å†…å®¹ã€‚

ç”±äºæˆ‘ä»¬åœ¨æ­¤å¤„ä½¿ç”¨çš„æ˜¯Â OpenAIï¼Œæ‰€ä»¥éœ€è¦æŒ‰ç…§Â OpenAIÂ è¦æ±‚çš„æ ¼å¼[8]æ¥æè¿°è¿™äº›Â toolsï¼ˆå‡½æ•°ï¼‰ã€‚

```python
toolsÂ = [
 {
 "type": "function",
 "function": {
 "name": "get_items",
 "description": "Get a list of items from the database",
 "parameters": {
 "type": "object",
 "properties": {
 "ids": {
 "type": "string",
 "description": "Comma separated list of item ids to fetch",
 },
 "categories": {
 "type": "string",
 "description": "Comma separated list of item categories to fetch",
 },
 },
 "required": [],
 },
 }
 },
 {
 "type": "function",
 "function": {
 "name": "purchase_item",
 "description": "Purchase a particular item",
 "parameters": {
 "type": "object",
 "properties": {
 "id": {
 "type": "string",
 "description": "The given product ID,Â product name is not accepted here.Â Please obtain the product ID from the database first.",
 },
 "quantity": {
 "type": "integer",
 "description": "Number of items to purchase",
 },
 },
 "required": [],
 },
 }
 },
 {
 "type": "function",
 "function": {
 "name": "rag_pipeline_func",
 "description": "Get information from hotel brochure",
 "parameters": {
 "type": "object",
 "properties": {
 "query": {
 "type": "string",
 "description": "The query to use in the search.Â Infer this from the user's message.Â It should be a question or a statement",
 }
 },
 "required": ["query"],
 },
 },
 }
]
```

### 4.5 æ­¥éª¤Â 3ï¼šå°†æ‰€æœ‰ç³»ç»Ÿç»„ä»¶æ•´åˆåœ¨ä¸€èµ·

æˆ‘ä»¬ç°åœ¨å·²ç»å‡†å¤‡å¥½äº†æµ‹è¯•å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰åŠŸèƒ½æ‰€éœ€çš„æ‰€æœ‰ç³»ç»Ÿç»„ä»¶ï¼è¿™ä¸€æ­¥éª¤æˆ‘ä»¬éœ€è¦åšä»¥ä¸‹å‡ ä»¶äº‹ï¼š

1.  ä¸ºæ¨¡å‹æä¾›åˆå§‹æç¤ºè¯ï¼ˆpromptï¼‰ï¼Œå¹¶ä¸ºå…¶æä¾›ä¸Šä¸‹æ–‡
2.  æä¾›æ ·ä¾‹ç”¨æˆ·æ¶ˆæ¯ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„Â queryÂ æˆ–éœ€æ±‚
3.  å°†ä¹‹å‰å®šä¹‰çš„å·¥å…·å‡½æ•°åˆ—è¡¨ï¼ˆtool listï¼‰ä½œä¸ºÂ `tools`Â å‚æ•°ä¼ é€’ç»™Â chat generatorÂ ï¼ˆè¯‘è€…æ³¨ï¼šç”Ÿæˆå¯¹è¯å¼å›å¤çš„è¯­è¨€æ¨¡å‹æˆ–Â AIÂ ç³»ç»Ÿï¼‰ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚

```python
#Â 1.Â Initial prompt
contextÂ = f"""You are an assistant to tourists visiting a hotel.
You have access to a database of itemsÂ (which includesÂ {get_categories()})Â that tourists can buy,Â you also have access to the hotel's brochure.
If the tourist's question cannot be answered from the database,Â you can refer to the brochure.
If the tourist's question cannot be answered from the brochure,Â you can ask the tourist to ask the hotel staff.
"""
messagesÂ = [
Â Â Â Â ChatMessage.from_system(context),
 #Â 2.Â Sample message from user
Â Â Â Â ChatMessage.from_user("Can I buy a coffee?"),
 ]

#Â 3.Â Passing the tools list and invoke the chat generator
responseÂ =Â chat_generator.run(messages=messages,Â generation_kwargs= {"tools":Â tools})
response
```

```python
----------Â ResponseÂ ----------
{'replies':Â [ChatMessage(content='[{"index":Â 0,Â "id":Â "call_AkTWoiJzx5uJSgKW0WAI1yBB",Â "function":Â {"arguments":Â "{\"categories\":\"Food and beverages\"}",Â "name":Â "get_items"},Â "type":Â "function"}]',Â role=<ChatRole.ASSISTANT:Â 'assistant'>,Â name=None,Â meta={'model':Â 'openai/gpt-4-turbo-preview',Â 'index':Â 0,Â 'finish_reason':Â 'tool_calls',Â 'usage':Â {}})]}
```

ç°åœ¨è®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹æ¨¡å‹å“åº”å†…å®¹ã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰æ‰€è¿”å›çš„å†…å®¹ï¼Œä¸ä»…åŒ…æ‹¬æ¨¡å‹é€‰æ‹©è°ƒç”¨çš„å‡½æ•°æœ¬èº«ï¼Œè¿˜åº”è¯¥åŒ…æ‹¬ä¸ºè°ƒç”¨è¯¥å‡½æ•°æ‰€ä¼ å…¥çš„å‚æ•°ã€‚**

```python
function_callÂ =Â json.loads(response["replies"][0].content)[0]
function_nameÂ =Â function_call["function"]["name"]
function_argsÂ =Â json.loads(function_call["function"]["arguments"])
print("Function Name:",Â function_name)
print("Function Arguments:",Â function_args)
```

```python
----------Â ResponseÂ ----------
Function Name:Â get_items
Function Arguments: {â€˜categoriesâ€™:Â â€˜FoodÂ andÂ beveragesâ€™}
```

å½“æ¨¡å‹é‡åˆ°å¦ä¸€ä¸ªæ–°é—®é¢˜æ—¶ï¼Œä¼šåˆ†æè¯¥é—®é¢˜ï¼Œç»“åˆå®ƒå·²æœ‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¯„ä¼°å“ªä¸€ä¸ªå¯ç”¨çš„å·¥å…·å‡½æ•°æœ€èƒ½å¤Ÿå¸®åŠ©å›ç­”è¿™ä¸ªé—®é¢˜ã€‚

```python
#Â Another question
messages.append(ChatMessage.from_user("Where's the coffee shop?"))

#Â Invoke the chat generator,Â and passing the tools list
responseÂ =Â chat_generator.run(messages=messages,Â generation_kwargs= {"tools":Â tools})
function_callÂ =Â json.loads(response["replies"][0].content)[0]
function_nameÂ =Â function_call["function"]["name"]
function_argsÂ =Â json.loads(function_call["function"]["arguments"])
print("Function Name:",Â function_name)
print("Function Arguments:",Â function_args)
```

```python
----------Â ResponseÂ ----------
Function Name:Â rag_pipeline_func
Function Arguments:Â {'query':Â "Where's the coffee shop?"}
```

è¯·å†æ¬¡æ³¨æ„ï¼Œè¿™ä¸€æ­¥éª¤å®é™…ä¸Šè¿˜æ²¡æœ‰çœŸæ­£è°ƒç”¨æ‰§è¡Œä»»ä½•å‡½æ•°ï¼ŒçœŸæ­£æ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œå°†æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¿™ä¸ªæ­¥éª¤è¦åšçš„ã€‚

**è°ƒç”¨å‡½æ•°**

è¿™ä¸€æ­¥éª¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å‚æ•°è¾“å…¥æ‰€é€‰å‡½æ•°ï¼š

```python
 ##Â Find the correspoding function and call it with the given arguments
available_functionsÂ =Â {"get_items":Â get_items,Â "purchase_item":Â purchase_item,"rag_pipeline_func":Â rag_pipeline_func}
function_to_callÂ =Â available_functions[function_name]
function_responseÂ =Â function_to_call(**function_args)
print("Function Response:",Â function_response)
```

```python
----------Â ResponseÂ ----------
Function Response:Â {'reply':Â 'The provided context does not specify a physical location for the coffee shop,Â only its operating hours.Â Therefore,Â I cannot determine where the coffee shop is located based on the given information.'} 
```

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¥è‡ªÂ `rag_pipeline_func`Â çš„æ¨¡å‹å“åº”ç»“æœï¼Œä½œä¸ºä¸Šä¸‹æ–‡ä¿¡æ¯é™„åŠ åˆ°Â `messages`Â å˜é‡ä¸­ï¼Œä»è€Œè®©æ¨¡å‹åŸºäºè¿™ä¸ªé™„åŠ çš„ä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç­”å¤ã€‚

```python
messages.append(ChatMessage.from_function(content=json.dumps(function_response),Â name=function_name))
responseÂ =Â chat_generator.run(messages=messages)
response_msgÂ =Â response["replies"][0]

print(response_msg.content)
```

```
----------Â ResponseÂ ----------
For the location of the coffee shop within the hotel,Â I recommend asking the hotel staff directly.Â They will be able to guide you to it accurately. 
```

ç°åœ¨å·²ç»å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·ä¸Â AIÂ çš„å¯¹è¯å¾ªç¯ï¼

### **4.6 æ­¥éª¤Â 4ï¼šå°†å…¶è½¬åŒ–ä¸ºå®æ—¶äº¤äº’å¼å¯¹è¯ï¼ˆinteractive chatï¼‰ç³»ç»Ÿ**

ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†å‡½æ•°è°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä½†æˆ‘ä»¬æƒ³æ›´è¿›ä¸€æ­¥ï¼Œå°†å…¶è½¬åŒ–ä¸ºå®æ—¶äº¤äº’å¼å¯¹è¯ï¼ˆinteractive chatï¼‰ç³»ç»Ÿã€‚

åœ¨æœ¬èŠ‚ï¼Œæˆ‘å±•ç¤ºäº†ä¸¤ç§å®ç°æ–¹å¼ï¼š

1.  **è¾ƒä¸ºåŸå§‹çš„Â input()Â æ–¹æ³•ï¼Œå°†å¯¹è¯å†…å®¹æ‰“å°åˆ°Â notebookÂ ä¸­ã€‚**
2.  **é€šè¿‡Â StreamlitÂ è¿›è¡Œæ¸²æŸ“ï¼Œæä¾›ç±»ä¼¼Â ChatGPTÂ çš„Â UIÂ ä½“éªŒã€‚**

**input()Â loop**

è¿™éƒ¨åˆ†ä»£ç æ˜¯ä»Â HaystackÂ çš„æ•™ç¨‹[9]ä¸­å¤åˆ¶è¿‡æ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå¿«é€Ÿæµ‹è¯•æ¨¡å‹ã€‚**è¯·æ³¨æ„ï¼šè¯¥åº”ç”¨ç¨‹åºæ˜¯ä¸ºäº†æ¼”ç¤ºå‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰è¿™ä¸€æ¦‚å¿µè€Œåˆ›å»ºçš„ï¼Œå¹¶éæ„å‘³ç€æ­¤åº”ç”¨ç¨‹åºçš„å¥å£®æ€§å®Œç¾ï¼Œä¾‹å¦‚ï¼šæ”¯æŒåŒæ—¶å¯¹å¤šä¸ªé¡¹ç›®è¿›è¡Œæ’åºã€æ— å¹»è§‰ç­‰ã€‚**

```python
importÂ json
fromÂ haystack.dataclassesÂ importÂ ChatMessage,Â ChatRole

responseÂ = None
messagesÂ = [
Â Â Â Â ChatMessage.from_system(context)
]

while True:
 #Â if OpenAI response is a tool call
 ifÂ responseÂ andÂ response["replies"][0].meta["finish_reason"] == "tool_calls":
Â Â Â Â Â Â Â Â function_callsÂ =Â json.loads(response["replies"][0].content)

 forÂ function_callÂ inÂ function_calls:
 ##Â Parse function calling information
Â Â Â Â Â Â Â Â Â Â Â Â function_nameÂ =Â function_call["function"]["name"]
Â Â Â Â Â Â Â Â Â Â Â Â function_argsÂ =Â json.loads(function_call["function"]["arguments"])

 ##Â Find the correspoding function and call it with the given arguments
Â Â Â Â Â Â Â Â Â Â Â Â function_to_callÂ =Â available_functions[function_name]
Â Â Â Â Â Â Â Â Â Â Â Â function_responseÂ =Â function_to_call(**function_args)

 ##Â Append function response to the messages list usingÂ `ChatMessage.from_function`
Â Â Â Â Â Â Â Â Â Â Â Â messages.append(ChatMessage.from_function(content=json.dumps(function_response),Â name=function_name))

 #Â Regular Conversation
 else:
 #Â Append assistant messages to the messages list
 if notÂ messages[-1].is_from(ChatRole.SYSTEM):
Â Â Â Â Â Â Â Â Â Â Â Â messages.append(response["replies"][0])

Â Â Â Â Â Â Â Â user_inputÂ = input("ENTER YOUR MESSAGEÂ ğŸ‘‡Â INFO:Â TypeÂ 'exit'Â orÂ 'quit'Â to stop\n")
 ifÂ user_input.lower() == "exit" orÂ user_input.lower() == "quit":
 break
 else:
Â Â Â Â Â Â Â Â Â Â Â Â messages.append(ChatMessage.from_user(user_input))

Â Â Â Â responseÂ =Â chat_generator.run(messages=messages,Â generation_kwargs={"tools":Â tools}) 
```

å°½ç®¡åŸºæœ¬çš„äº¤äº’æ–¹å¼ä¹Ÿå¯ä»¥è¿è¡Œä½¿ç”¨ï¼Œä½†æ‹¥æœ‰ä¸€ä¸ªæ›´åŠ ç¾è§‚å‹å¥½çš„ç”¨æˆ·ç•Œé¢ä¼šè®©ç”¨æˆ·ä½“éªŒæ›´åŠ å‡ºè‰²ã€‚

**StreamlitÂ ç•Œé¢**

StreamlitÂ èƒ½å¤Ÿå°†Â PythonÂ è„šæœ¬å’ŒÂ WebÂ å¼€å‘æŠ€æœ¯ä¼˜é›…åœ°ç»“åˆï¼Œè½¬åŒ–ä¸ºå¯å…±äº«ä½¿ç”¨çš„Â WebÂ æœåŠ¡åº”ç”¨ï¼Œä¸ºè¿™ä¸ªå‡½æ•°è°ƒç”¨äº¤äº’å¼åº”ç”¨ç¨‹åºæ„å»ºäº†ä¸€ä¸ªå…¨æ–°çš„Â WebÂ ç•Œé¢ã€‚ä¸Šè¿°ä»£ç å·²è¢«æ”¹ç¼–æˆä¸€ä¸ªÂ StreamlitÂ åº”ç”¨ï¼Œä½äºä»£ç ä»“åº“çš„Â streamlitÂ æ–‡ä»¶å¤¹ä¸­ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿è¡Œè¯¥åº”ç”¨ï¼š

1.  å¦‚æœè¿˜æœªè¿è¡Œï¼Œè¯·ä½¿ç”¨Â `python db_api.py`Â å¯åŠ¨Â APIÂ æœåŠ¡å™¨ã€‚
2.  å°†Â `OPENROUTER_API_KEY`Â è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚åœ¨Â LinuxÂ ä¸Šæˆ–ä½¿ç”¨Â `git bash`Â æ—¶ï¼Œæ‰§è¡ŒÂ `export OPENROUTER_API_KEY='@æ›¿æ¢ä¸ºæ‚¨çš„APIå¯†é’¥'`ã€‚
3.  åœ¨ç»ˆç«¯ä¸­è¿›å…¥Â streamlitÂ æ–‡ä»¶å¤¹ï¼Œç›®å½•åˆ‡æ¢å‘½ä»¤ä¸ºÂ `cd streamlit`ã€‚
4.  è¿è¡ŒÂ `streamlit run app.py`Â å¯åŠ¨Â Streamlitã€‚æµè§ˆå™¨åº”è¯¥ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œè¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚

åŸºæœ¬ä¸Šæˆ‘æƒ³ä»‹ç»çš„å†…å®¹å°±æ˜¯è¿™äº›äº†ï¼çœŸå¿ƒå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚

![Alt text](_Streamlit_UI_.png)
